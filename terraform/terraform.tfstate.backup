{
    "version": 1,
    "serial": 84,
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "openstack_compute_floatingip_v2.kuberdemo.0": {
                    "type": "openstack_compute_floatingip_v2",
                    "primary": {
                        "id": "76",
                        "attributes": {
                            "address": "10.42.45.76",
                            "fixed_ip": "",
                            "id": "76",
                            "instance_id": "",
                            "pool": "nova",
                            "region": "RegionOne"
                        }
                    }
                },
                "openstack_compute_floatingip_v2.kuberdemo.1": {
                    "type": "openstack_compute_floatingip_v2",
                    "primary": {
                        "id": "78",
                        "attributes": {
                            "address": "10.42.45.78",
                            "fixed_ip": "",
                            "id": "78",
                            "instance_id": "",
                            "pool": "nova",
                            "region": "RegionOne"
                        }
                    }
                },
                "openstack_compute_floatingip_v2.kuberdemo.2": {
                    "type": "openstack_compute_floatingip_v2",
                    "primary": {
                        "id": "77",
                        "attributes": {
                            "address": "10.42.45.77",
                            "fixed_ip": "",
                            "id": "77",
                            "instance_id": "",
                            "pool": "nova",
                            "region": "RegionOne"
                        }
                    }
                },
                "openstack_compute_instance_v2.etcd.0": {
                    "type": "openstack_compute_instance_v2",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "template_file.kuberdemo-user-data"
                    ],
                    "primary": {
                        "id": "d6313519-62da-4768-98f8-a0a204f2689d",
                        "attributes": {
                            "access_ip_v4": "10.42.45.76",
                            "access_ip_v6": "",
                            "flavor_id": "2",
                            "flavor_name": "m1.small",
                            "floating_ip": "10.42.45.76",
                            "id": "d6313519-62da-4768-98f8-a0a204f2689d",
                            "image_id": "28233205-3b97-406f-9921-63f4af639010",
                            "image_name": "CoreOS-alpha",
                            "key_pair": "kuberdemo-keypair",
                            "metadata.#": "0",
                            "name": "coreos-1",
                            "network.#": "1",
                            "network.0.fixed_ip_v4": "192.168.9.4",
                            "network.0.fixed_ip_v6": "",
                            "network.0.mac": "fa:16:3e:0b:ee:ec",
                            "network.0.name": "private_9",
                            "network.0.port": "",
                            "network.0.uuid": "",
                            "region": "RegionOne",
                            "security_groups.#": "1",
                            "security_groups.0": "kuberdemo",
                            "user_data": "531d8b99fb1eeb74800596d76e083726e77bcdd5"
                        }
                    }
                },
                "openstack_compute_instance_v2.etcd.1": {
                    "type": "openstack_compute_instance_v2",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "template_file.kuberdemo-user-data"
                    ],
                    "primary": {
                        "id": "d4cd0f96-41d5-4c64-8edf-8efeb4c3eeb7",
                        "attributes": {
                            "access_ip_v4": "10.42.45.78",
                            "access_ip_v6": "",
                            "flavor_id": "2",
                            "flavor_name": "m1.small",
                            "floating_ip": "10.42.45.78",
                            "id": "d4cd0f96-41d5-4c64-8edf-8efeb4c3eeb7",
                            "image_id": "28233205-3b97-406f-9921-63f4af639010",
                            "image_name": "CoreOS-alpha",
                            "key_pair": "kuberdemo-keypair",
                            "metadata.#": "0",
                            "name": "coreos-2",
                            "network.#": "1",
                            "network.0.fixed_ip_v4": "192.168.9.5",
                            "network.0.fixed_ip_v6": "",
                            "network.0.mac": "fa:16:3e:49:44:79",
                            "network.0.name": "private_9",
                            "network.0.port": "",
                            "network.0.uuid": "",
                            "region": "RegionOne",
                            "security_groups.#": "1",
                            "security_groups.0": "kuberdemo",
                            "user_data": "1f8e5ab370222d1afa4390c9b5c7a610974fc633"
                        }
                    }
                },
                "openstack_compute_instance_v2.etcd.2": {
                    "type": "openstack_compute_instance_v2",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "template_file.kuberdemo-user-data"
                    ],
                    "primary": {
                        "id": "bfe83c20-ce37-4f30-b371-a973bc8c4a7a",
                        "attributes": {
                            "access_ip_v4": "10.42.45.77",
                            "access_ip_v6": "",
                            "flavor_id": "2",
                            "flavor_name": "m1.small",
                            "floating_ip": "10.42.45.77",
                            "id": "bfe83c20-ce37-4f30-b371-a973bc8c4a7a",
                            "image_id": "28233205-3b97-406f-9921-63f4af639010",
                            "image_name": "CoreOS-alpha",
                            "key_pair": "kuberdemo-keypair",
                            "metadata.#": "0",
                            "name": "coreos-3",
                            "network.#": "1",
                            "network.0.fixed_ip_v4": "192.168.9.3",
                            "network.0.fixed_ip_v6": "",
                            "network.0.mac": "fa:16:3e:eb:56:69",
                            "network.0.name": "private_9",
                            "network.0.port": "",
                            "network.0.uuid": "",
                            "region": "RegionOne",
                            "security_groups.#": "1",
                            "security_groups.0": "kuberdemo",
                            "user_data": "e5e12088114d659dcfcc8c9d68f77b007097fe12"
                        }
                    }
                },
                "openstack_compute_keypair_v2.kuberdemo-keypair": {
                    "type": "openstack_compute_keypair_v2",
                    "primary": {
                        "id": "kuberdemo-keypair",
                        "attributes": {
                            "id": "kuberdemo-keypair",
                            "name": "kuberdemo-keypair",
                            "public_key": "ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDTySHW4gd005HhvjwvXHs7kc9G53FCM7YApL/NYrJrLnQEFOh5eOiEH4i3DedNV+bBtCGfl7ShPHKhPRqN1FKkQz3jRYbSx9rz3YBVr93yu8tsxr/4E4DkG118NEaUnYsQbl8EneT1R3N6SOOnV3n3Pi11Hj7QdtpCR6ireYIyT4OBIkYH/ZB3+jX6O/I51/WArhpZJ4Rt913kWznNkVAKn3CLVLyDX9bDqR8fhIPoaC3Du5KWm0/C+ZGssmruaFOCDexrsdScI5+R63MZbo6pKHuLcu6fpu70nyY/HLah36xwiJIxSljvO3uXDwVwEBFLrWax47PowvaYc7jp7jQD kuberdemo",
                            "region": "RegionOne"
                        }
                    }
                },
                "openstack_compute_secgroup_v2.kuberdemo": {
                    "type": "openstack_compute_secgroup_v2",
                    "primary": {
                        "id": "136",
                        "attributes": {
                            "description": "k8s demo communication permissions",
                            "id": "136",
                            "name": "kuberdemo",
                            "region": "RegionOne",
                            "rule.#": "3",
                            "rule.0.cidr": "0.0.0.0/0",
                            "rule.0.from_group_id": "",
                            "rule.0.from_port": "-1",
                            "rule.0.id": "",
                            "rule.0.ip_protocol": "icmp",
                            "rule.0.self": "false",
                            "rule.0.to_port": "-1",
                            "rule.1.cidr": "0.0.0.0/0",
                            "rule.1.from_group_id": "",
                            "rule.1.from_port": "1",
                            "rule.1.id": "",
                            "rule.1.ip_protocol": "tcp",
                            "rule.1.self": "false",
                            "rule.1.to_port": "65535",
                            "rule.2.cidr": "0.0.0.0/0",
                            "rule.2.from_group_id": "",
                            "rule.2.from_port": "1",
                            "rule.2.id": "",
                            "rule.2.ip_protocol": "udp",
                            "rule.2.self": "false",
                            "rule.2.to_port": "65535"
                        }
                    }
                },
                "template_file.kuber-address-lines.0": {
                    "type": "template_file",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo"
                    ],
                    "primary": {
                        "id": "a488accd3c41063c41e99b7487db543649f189bd6950ddf9f7bf53bee3401c51",
                        "attributes": {
                            "filename": "./address-line",
                            "id": "a488accd3c41063c41e99b7487db543649f189bd6950ddf9f7bf53bee3401c51",
                            "rendered": "kuberdemo-etcd-1=http://10.42.45.76:2380",
                            "vars.#": "2",
                            "vars.ip_address": "10.42.45.76",
                            "vars.machine_num": "1"
                        }
                    }
                },
                "template_file.kuber-address-lines.1": {
                    "type": "template_file",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo"
                    ],
                    "primary": {
                        "id": "2d1221822d3b80970ae5499f25a4b496ebe7ee36141e0bb0da2a1c8110030edd",
                        "attributes": {
                            "filename": "./address-line",
                            "id": "2d1221822d3b80970ae5499f25a4b496ebe7ee36141e0bb0da2a1c8110030edd",
                            "rendered": "kuberdemo-etcd-2=http://10.42.45.78:2380",
                            "vars.#": "2",
                            "vars.ip_address": "10.42.45.78",
                            "vars.machine_num": "2"
                        }
                    }
                },
                "template_file.kuber-address-lines.2": {
                    "type": "template_file",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo"
                    ],
                    "primary": {
                        "id": "35f17c6cde32fca8e8d871c30f0c98a9c97551a1d4e36c1937c5235e147cb976",
                        "attributes": {
                            "filename": "./address-line",
                            "id": "35f17c6cde32fca8e8d871c30f0c98a9c97551a1d4e36c1937c5235e147cb976",
                            "rendered": "kuberdemo-etcd-3=http://10.42.45.77:2380",
                            "vars.#": "2",
                            "vars.ip_address": "10.42.45.77",
                            "vars.machine_num": "3"
                        }
                    }
                },
                "template_file.kuberdemo-user-data.0": {
                    "type": "template_file",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "template_file.kuber-address-lines"
                    ],
                    "primary": {
                        "id": "8b06eeee3592b49581e45b21a218f440dccb26f09f45a455df51ebb14b56be31",
                        "attributes": {
                            "filename": "./user-data",
                            "id": "8b06eeee3592b49581e45b21a218f440dccb26f09f45a455df51ebb14b56be31",
                            "rendered": "#cloud-config\n\ncoreos:\n  etcd2:\n    name: kuberdemo-etcd-1\n    initial-cluster: kuberdemo-etcd-1=http://10.42.45.76:2380,kuberdemo-etcd-2=http://10.42.45.78:2380,kuberdemo-etcd-3=http://10.42.45.77:2380\n    initial-cluster-token: hdsfasdnuajodlk\n    initial-cluster-state: new\n\n    initial-advertise-peer-urls: http://10.42.45.76:2380\n    listen-peer-urls: http://0.0.0.0:2380\n    \n    advertise-client-urls: http://10.42.45.76:2379\n    listen-client-urls: http://0.0.0.0:2379\n\n  fleet:\n    public-ip: 10.42.45.76\n    etcd-servers: http://127.0.0.1:2379\n\n  flannel:\n    interface: $private_ipv4\n\n  units:\n    - name: etcd2.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: flanneld.service\n      drop-ins:\n        - name: 50-network-config.conf\n          content: |\n            [Service]\n            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{ \"Network\": \"10.1.0.0/16\" }'\n      command: start\n\n    - name: docker-tcp.socket\n      command: start\n      enable: true\n      content: |\n        [Unit]\n        Description=Docker Socket for the API\n\n        [Socket]\n        ListenStream=2375\n        Service=docker.service\n        BindIPv6Only=both\n\n        [Install]\n        WantedBy=sockets.target\n\n    - name: pull-bins.service\n      command: start\n      content: |\n        [Unit]\n        Description=Get kubernetes binarys\n        Requires=network-online.target\n        After=network-online.target\n        [Service]\n        ExecStart=/opt/bin/pull_bins.sh\n        Type=oneshot\n        RemainAfterExit=true\n\nwrite_files:\n  # this is needed since fleetctl is configured by defautl to talk to etcd on\n  # port 4011 :/\n  - content: FLEET_ETCD_SERVERS=http://127.0.0.1:2379\n    owner: root:root\n    path: /etc/default/fleetctl\n    permissions: '0644'\n  - content: |\n      #!/bin/bash -e\n      mkdir -p /opt/bin\n      bins=( kubectl kubelet kube-proxy kube-apiserver kube-scheduler kube-controller-manager )\n      for b in \"${bins[@]}\"; do\n          curl -L https://storage.googleapis.com/kubernetes-release/release/v0.21.4/bin/linux/amd64/$b 2\u003e/dev/null \u003e /opt/bin/$b\n          chmod a+x /opt/bin/$b\n      done\n    owner: root:root\n    path: /opt/bin/pull_bins.sh\n    permissions: '0755'\n  - content: |\n      [[ $- != *i* ]] \u0026\u0026 return\n      # enable vi mode for bash\n      set -o vi\n      # put demo bins on path\n      export PATH=/opt/bin:$PATH\n    owner: core:core\n    path: /home/core/.bashrc\n    permissions: '0644'\n",
                            "vars.#": "4",
                            "vars.initial_cluster": "kuberdemo-etcd-1=http://10.42.45.76:2380,kuberdemo-etcd-2=http://10.42.45.78:2380,kuberdemo-etcd-3=http://10.42.45.77:2380",
                            "vars.initial_cluster_token": "hdsfasdnuajodlk",
                            "vars.machine_num": "1",
                            "vars.public_ipv4": "10.42.45.76"
                        }
                    }
                },
                "template_file.kuberdemo-user-data.1": {
                    "type": "template_file",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "template_file.kuber-address-lines"
                    ],
                    "primary": {
                        "id": "3bdd654e19bf217cdaf4183415722397212413cd6e5b510bd84cb88b5ccc9070",
                        "attributes": {
                            "filename": "./user-data",
                            "id": "3bdd654e19bf217cdaf4183415722397212413cd6e5b510bd84cb88b5ccc9070",
                            "rendered": "#cloud-config\n\ncoreos:\n  etcd2:\n    name: kuberdemo-etcd-2\n    initial-cluster: kuberdemo-etcd-1=http://10.42.45.76:2380,kuberdemo-etcd-2=http://10.42.45.78:2380,kuberdemo-etcd-3=http://10.42.45.77:2380\n    initial-cluster-token: hdsfasdnuajodlk\n    initial-cluster-state: new\n\n    initial-advertise-peer-urls: http://10.42.45.78:2380\n    listen-peer-urls: http://0.0.0.0:2380\n    \n    advertise-client-urls: http://10.42.45.78:2379\n    listen-client-urls: http://0.0.0.0:2379\n\n  fleet:\n    public-ip: 10.42.45.78\n    etcd-servers: http://127.0.0.1:2379\n\n  flannel:\n    interface: $private_ipv4\n\n  units:\n    - name: etcd2.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: flanneld.service\n      drop-ins:\n        - name: 50-network-config.conf\n          content: |\n            [Service]\n            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{ \"Network\": \"10.1.0.0/16\" }'\n      command: start\n\n    - name: docker-tcp.socket\n      command: start\n      enable: true\n      content: |\n        [Unit]\n        Description=Docker Socket for the API\n\n        [Socket]\n        ListenStream=2375\n        Service=docker.service\n        BindIPv6Only=both\n\n        [Install]\n        WantedBy=sockets.target\n\n    - name: pull-bins.service\n      command: start\n      content: |\n        [Unit]\n        Description=Get kubernetes binarys\n        Requires=network-online.target\n        After=network-online.target\n        [Service]\n        ExecStart=/opt/bin/pull_bins.sh\n        Type=oneshot\n        RemainAfterExit=true\n\nwrite_files:\n  # this is needed since fleetctl is configured by defautl to talk to etcd on\n  # port 4011 :/\n  - content: FLEET_ETCD_SERVERS=http://127.0.0.1:2379\n    owner: root:root\n    path: /etc/default/fleetctl\n    permissions: '0644'\n  - content: |\n      #!/bin/bash -e\n      mkdir -p /opt/bin\n      bins=( kubectl kubelet kube-proxy kube-apiserver kube-scheduler kube-controller-manager )\n      for b in \"${bins[@]}\"; do\n          curl -L https://storage.googleapis.com/kubernetes-release/release/v0.21.4/bin/linux/amd64/$b 2\u003e/dev/null \u003e /opt/bin/$b\n          chmod a+x /opt/bin/$b\n      done\n    owner: root:root\n    path: /opt/bin/pull_bins.sh\n    permissions: '0755'\n  - content: |\n      [[ $- != *i* ]] \u0026\u0026 return\n      # enable vi mode for bash\n      set -o vi\n      # put demo bins on path\n      export PATH=/opt/bin:$PATH\n    owner: core:core\n    path: /home/core/.bashrc\n    permissions: '0644'\n",
                            "vars.#": "4",
                            "vars.initial_cluster": "kuberdemo-etcd-1=http://10.42.45.76:2380,kuberdemo-etcd-2=http://10.42.45.78:2380,kuberdemo-etcd-3=http://10.42.45.77:2380",
                            "vars.initial_cluster_token": "hdsfasdnuajodlk",
                            "vars.machine_num": "2",
                            "vars.public_ipv4": "10.42.45.78"
                        }
                    }
                },
                "template_file.kuberdemo-user-data.2": {
                    "type": "template_file",
                    "depends_on": [
                        "openstack_compute_floatingip_v2.kuberdemo",
                        "template_file.kuber-address-lines"
                    ],
                    "primary": {
                        "id": "c47d6ef77c65c4f22e9e0780fef7868898f5437a97dd128b6d0684f5bad97393",
                        "attributes": {
                            "filename": "./user-data",
                            "id": "c47d6ef77c65c4f22e9e0780fef7868898f5437a97dd128b6d0684f5bad97393",
                            "rendered": "#cloud-config\n\ncoreos:\n  etcd2:\n    name: kuberdemo-etcd-3\n    initial-cluster: kuberdemo-etcd-1=http://10.42.45.76:2380,kuberdemo-etcd-2=http://10.42.45.78:2380,kuberdemo-etcd-3=http://10.42.45.77:2380\n    initial-cluster-token: hdsfasdnuajodlk\n    initial-cluster-state: new\n\n    initial-advertise-peer-urls: http://10.42.45.77:2380\n    listen-peer-urls: http://0.0.0.0:2380\n    \n    advertise-client-urls: http://10.42.45.77:2379\n    listen-client-urls: http://0.0.0.0:2379\n\n  fleet:\n    public-ip: 10.42.45.77\n    etcd-servers: http://127.0.0.1:2379\n\n  flannel:\n    interface: $private_ipv4\n\n  units:\n    - name: etcd2.service\n      command: start\n    - name: fleet.service\n      command: start\n    - name: flanneld.service\n      drop-ins:\n        - name: 50-network-config.conf\n          content: |\n            [Service]\n            ExecStartPre=/usr/bin/etcdctl set /coreos.com/network/config '{ \"Network\": \"10.1.0.0/16\" }'\n      command: start\n\n    - name: docker-tcp.socket\n      command: start\n      enable: true\n      content: |\n        [Unit]\n        Description=Docker Socket for the API\n\n        [Socket]\n        ListenStream=2375\n        Service=docker.service\n        BindIPv6Only=both\n\n        [Install]\n        WantedBy=sockets.target\n\n    - name: pull-bins.service\n      command: start\n      content: |\n        [Unit]\n        Description=Get kubernetes binarys\n        Requires=network-online.target\n        After=network-online.target\n        [Service]\n        ExecStart=/opt/bin/pull_bins.sh\n        Type=oneshot\n        RemainAfterExit=true\n\nwrite_files:\n  # this is needed since fleetctl is configured by defautl to talk to etcd on\n  # port 4011 :/\n  - content: FLEET_ETCD_SERVERS=http://127.0.0.1:2379\n    owner: root:root\n    path: /etc/default/fleetctl\n    permissions: '0644'\n  - content: |\n      #!/bin/bash -e\n      mkdir -p /opt/bin\n      bins=( kubectl kubelet kube-proxy kube-apiserver kube-scheduler kube-controller-manager )\n      for b in \"${bins[@]}\"; do\n          curl -L https://storage.googleapis.com/kubernetes-release/release/v0.21.4/bin/linux/amd64/$b 2\u003e/dev/null \u003e /opt/bin/$b\n          chmod a+x /opt/bin/$b\n      done\n    owner: root:root\n    path: /opt/bin/pull_bins.sh\n    permissions: '0755'\n  - content: |\n      [[ $- != *i* ]] \u0026\u0026 return\n      # enable vi mode for bash\n      set -o vi\n      # put demo bins on path\n      export PATH=/opt/bin:$PATH\n    owner: core:core\n    path: /home/core/.bashrc\n    permissions: '0644'\n",
                            "vars.#": "4",
                            "vars.initial_cluster": "kuberdemo-etcd-1=http://10.42.45.76:2380,kuberdemo-etcd-2=http://10.42.45.78:2380,kuberdemo-etcd-3=http://10.42.45.77:2380",
                            "vars.initial_cluster_token": "hdsfasdnuajodlk",
                            "vars.machine_num": "3",
                            "vars.public_ipv4": "10.42.45.77"
                        }
                    }
                }
            }
        }
    ]
}
